{"remainingRequest":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/babel-loader/lib/index.js!/Users/abadboy/Documents/works/yitaibox_web/node_modules/eslint-loader/index.js??ref--13-0!/Users/abadboy/Documents/works/yitaibox_web/src/dbchain-js-client/src/blockchain.js","dependencies":[{"path":"/Users/abadboy/Documents/works/yitaibox_web/src/dbchain-js-client/src/blockchain.js","mtime":1627026042241},{"path":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/cache-loader/dist/cjs.js","mtime":1622543821598},{"path":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/babel-loader/lib/index.js","mtime":1609932570543},{"path":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/eslint-loader/index.js","mtime":1622543823631}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIi9Vc2Vycy9hYmFkYm95L0RvY3VtZW50cy93b3Jrcy95aXRhaWJveF93ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL1VzZXJzL2FiYWRib3kvRG9jdW1lbnRzL3dvcmtzL3lpdGFpYm94X3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmVudHJpZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgRmFjdG9yeSBmcm9tICcuL3R4X2ZhY3RvcnknOwppbXBvcnQgeyBnZXRQcml2S2V5LCBnZXRQdWJLZXksIGdldEFkZHJlc3MgfSBmcm9tICIuL2tleV9tYW5hZ2VyIjsKdmFyIGNoYWluSWRLZXkgPSAiZGJjaGFpbl9jaGFpbl9pZCI7CnZhciBkZWZhdWx0Q2hhaW5JZCA9ICJ0ZXN0bmV0IjsKdmFyIGNoYWluSWQgPSBudWxsOwp2YXIgRXh0cmFNc2dDb25zdHJ1Y3RvcnMgPSBbXTsKdmFyIExhenlGYWN0b3J5ID0gbnVsbDsKdmFyIE1zZ1F1ZXVlID0gW107CnZhciBNdXRleCA9IHRydWU7CgpmdW5jdGlvbiBzZXRDaGFpbklkKGlkKSB7CiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY2hhaW5JZEtleSwgaWQpOwogIGNoYWluSWQgPSBpZDsKfQoKZnVuY3Rpb24gZ2V0Q2hhaW5JZCgpIHsKICBpZiAoY2hhaW5JZCAhPSBudWxsKSB7CiAgICByZXR1cm4gY2hhaW5JZDsKICB9CgogIGNoYWluSWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjaGFpbklkS2V5KSB8fCBkZWZhdWx0Q2hhaW5JZDsKICByZXR1cm4gY2hhaW5JZDsKfQoKZnVuY3Rpb24gcmVzZXRMYXp5RmFjdG9yeSgpIHsKICBMYXp5RmFjdG9yeSA9IG51bGw7Cn0KCmZ1bmN0aW9uIGFkZEV4dHJhTXNnQ29uc3RydWN0b3JzKG1vZHVsZSkgewogIEV4dHJhTXNnQ29uc3RydWN0b3JzID0gRXh0cmFNc2dDb25zdHJ1Y3RvcnMuY29uY2F0KE9iamVjdC5lbnRyaWVzKG1vZHVsZSkpOwp9CgpmdW5jdGlvbiBnZXRXYWxsZXQoKSB7CiAgdmFyIHByaXZhdGVLZXkgPSBnZXRQcml2S2V5KCk7CiAgdmFyIHB1YmxpY0tleSA9IGdldFB1YktleSgpOwogIHZhciBhZGRyZXNzID0gZ2V0QWRkcmVzcygpOwogIHJldHVybiB7CiAgICBwcml2YXRlS2V5OiBwcml2YXRlS2V5LAogICAgcHVibGljS2V5OiBwdWJsaWNLZXksCiAgICBhZGRyZXNzOiBhZGRyZXNzCiAgfTsKfQoKZnVuY3Rpb24gd29yaygpIHsKICByZXR1cm4gX3dvcmsuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX3dvcmsoKSB7CiAgX3dvcmsgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICB2YXIgam9iLCBiYXRjaCwgY2FsbGJhY2s7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGpvYiA9IE1zZ1F1ZXVlLnNoaWZ0KCk7CiAgICAgICAgICAgIGJhdGNoID0gW107CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBpZiAoIShqb2IgIT0gbnVsbCkpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJhdGNoLnB1c2goam9iKTsKICAgICAgICAgICAgY2FsbGJhY2sgPSBqb2IubXNnWzJdOwoKICAgICAgICAgICAgaWYgKCEodHlwZW9mIGNhbGxiYWNrID09ICJmdW5jdGlvbiIgfHwgdHlwZW9mIGNhbGxiYWNrID09ICJib29sZWFuIiAmJiBjYWxsYmFjaykpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA2OwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgcmV0dXJuIHJlYWxTaWduQW5kQnJvYWRjYXN0KGJhdGNoKTsKCiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDExOwogICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDYpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiQW9jaGVlc2g6ICIsIF9jb250ZXh0LnQwKTsKCiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBiYXRjaCA9IFtdOwoKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIGpvYiA9IE1zZ1F1ZXVlLnNoaWZ0KCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICBpZiAoIShiYXRjaC5sZW5ndGggPiAwKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE5OwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjI7CiAgICAgICAgICAgIHJldHVybiByZWFsU2lnbkFuZEJyb2FkY2FzdChiYXRjaCk7CgogICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI3OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjQ7CiAgICAgICAgICAgIF9jb250ZXh0LnQxID0gX2NvbnRleHRbImNhdGNoIl0oMTkpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiQW9jaGVlc2g6ICIsIF9jb250ZXh0LnQxKTsKCiAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbNiwgMTFdLCBbMTksIDI0XV0pOwogIH0pKTsKICByZXR1cm4gX3dvcmsuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gc3RhcnRXb3JraW5nKCkgewogIHJldHVybiBfc3RhcnRXb3JraW5nLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0gLy8gd2hlbiBjYWxsYmFjayBpcyBhIGZ1bmN0aW9uIG9yIHRoZSB0cnVlIHZhbHVlIG9mIGJvb2xlYW4sCi8vIHdlIHRyaWdnZXIgdGhlIHdvcmtlciB0byBhY3QKCgpmdW5jdGlvbiBfc3RhcnRXb3JraW5nKCkgewogIF9zdGFydFdvcmtpbmcgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaWYgKCFNdXRleCkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTXV0ZXggPSBmYWxzZTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICByZXR1cm4gd29yaygpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgTXV0ZXggPSB0cnVlOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDg7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgY29uc29sZS5sb2coIkFub3RoZXIgd29ya2VyIGlzIHN0aWxsIHdvcmtpbmcuIEknbGwgd2FpdCBpbiBxdWV1ZS4iKTsKCiAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUyKTsKICB9KSk7CiAgcmV0dXJuIF9zdGFydFdvcmtpbmcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gc2lnbkFuZEJyb2FkY2FzdChtc2dOYW1lLCBhcmdzLCBjYWxsYmFjaykgewogIHZhciBtc2cgPSB7CiAgICBtc2c6IFttc2dOYW1lLCBhcmdzLCBjYWxsYmFja10KICB9OwogIE1zZ1F1ZXVlLnB1c2gobXNnKTsKCiAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PSAiZnVuY3Rpb24iIHx8IHR5cGVvZiBjYWxsYmFjayA9PSAiYm9vbGVhbiIgJiYgY2FsbGJhY2spIHsKICAgIHN0YXJ0V29ya2luZygpOwogIH0KfQoKZnVuY3Rpb24gcmVhbFNpZ25BbmRCcm9hZGNhc3QoX3gpIHsKICByZXR1cm4gX3JlYWxTaWduQW5kQnJvYWRjYXN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIF9yZWFsU2lnbkFuZEJyb2FkY2FzdCgpIHsKICBfcmVhbFNpZ25BbmRCcm9hZGNhc3QgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGJhdGNoKSB7CiAgICB2YXIgY2FsbGJhY2ssIG1zZ3MsIGluY2x1ZGVkOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgLy9tc2dOYW1lLCBhcmdzLCBjYWxsYmFjaykgewogICAgICAgICAgICBpZiAoTGF6eUZhY3RvcnkgPT0gbnVsbCkgewogICAgICAgICAgICAgIExhenlGYWN0b3J5ID0gbmV3IEZhY3RvcnkoZ2V0Q2hhaW5JZCgpLCBnZXRXYWxsZXQoKSwgRXh0cmFNc2dDb25zdHJ1Y3RvcnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAgIG1zZ3MgPSBbXTsKICAgICAgICAgICAgYmF0Y2guZm9yRWFjaChmdW5jdGlvbiAoam9iKSB7CiAgICAgICAgICAgICAgdmFyIF9qb2IkbXNnID0gX3NsaWNlZFRvQXJyYXkoam9iLm1zZywgMyksCiAgICAgICAgICAgICAgICAgIG1zZ05hbWUgPSBfam9iJG1zZ1swXSwKICAgICAgICAgICAgICAgICAgYXJncyA9IF9qb2IkbXNnWzFdLAogICAgICAgICAgICAgICAgICBjbGJrID0gX2pvYiRtc2dbMl07CgogICAgICAgICAgICAgIGNhbGxiYWNrID0gY2xiazsKCiAgICAgICAgICAgICAgaWYgKG1zZ05hbWUpIHsKICAgICAgICAgICAgICAgIG1zZ3MucHVzaChMYXp5RmFjdG9yeVttc2dOYW1lXShhcmdzKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA2OwogICAgICAgICAgICByZXR1cm4gTGF6eUZhY3Rvcnkuc2VuZChtc2dzLm1hcChmdW5jdGlvbiAoeCkgewogICAgICAgICAgICAgIHJldHVybiB4Lm1lc3NhZ2U7CiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGluY2x1ZGVkID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICBjYWxsYmFjayhpbmNsdWRlZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUzKTsKICB9KSk7CiAgcmV0dXJuIF9yZWFsU2lnbkFuZEJyb2FkY2FzdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBzZXRMYXp5RmFjdG9yeSgpIHsKICByZXR1cm4gX3NldExhenlGYWN0b3J5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIF9zZXRMYXp5RmFjdG9yeSgpIHsKICBfc2V0TGF6eUZhY3RvcnkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgdmFyIGNoYWluSWQsCiAgICAgICAgZnJvbVdhbGxldCwKICAgICAgICBtc2csCiAgICAgICAgX2FyZ3M0ID0gYXJndW1lbnRzOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgY2hhaW5JZCA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzBdIDogJ3l0Ym94JzsKICAgICAgICAgICAgZnJvbVdhbGxldCA9IF9hcmdzNC5sZW5ndGggPiAxICYmIF9hcmdzNFsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzFdIDogewogICAgICAgICAgICAgIGFkZHJlc3M6ICJjb3Ntb3MxMHh3dzI5dDJ4cDZ0ZnljZGp4MjdrNHZramxrd3cwc3dzNGVwZGQiLAogICAgICAgICAgICAgIHByaXZhdGVLZXk6IFsxOTYsIDE0OSwgMCwgMTU4LCAxOTAsIDgsIDI1MCwgMTY3LCAxMDYsIDUxLCAzNSwgMjQ5LCA4OCwgMTgwLCAxNjAsIDIzMSwgMjQyLCAyMywgMjMwLCAxMDksIDI1NSwgMjQ2LCAyMTUsIDc0LCA1MiwgMjksIDE1NCwgMywgMjE0LCAxODYsIDE5MCwgMTgyXSwKICAgICAgICAgICAgICBwdWJsaWNLZXk6IFsyLCAyMjksIDEwMywgMjQsIDE0NCwgMTg4LCAwLCA5MCwgMjMwLCAxNTgsIDE0NiwgMTEzLCA4OCwgMTczLCA0NSwgMTc3LCAxMDMsIDE2MCwgMTA1LCA2MSwgOTcsIDE4NiwgMjQ0LCAyOCwgODUsIDI0MSwgNzcsIDIzMywgNDUsIDcyLCAyMTQsIDg2LCAxNjRdCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG1zZyA9IF9hcmdzNC5sZW5ndGggPiAyICYmIF9hcmdzNFsyXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzJdIDogW107CiAgICAgICAgICAgIExhenlGYWN0b3J5ID0gbmV3IEZhY3RvcnkoY2hhaW5JZCwgZnJvbVdhbGxldCwgbXNnKTsKICAgICAgICAgICAgY29uc29sZS5sb2coTGF6eUZhY3RvcnkpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTQpOwogIH0pKTsKICByZXR1cm4gX3NldExhenlGYWN0b3J5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCB7IHNpZ25BbmRCcm9hZGNhc3QsIGFkZEV4dHJhTXNnQ29uc3RydWN0b3JzLCBnZXRDaGFpbklkLCBzZXRDaGFpbklkLCByZXNldExhenlGYWN0b3J5LCBzZXRMYXp5RmFjdG9yeSB9Ow=="},{"version":3,"sources":["/Users/abadboy/Documents/works/yitaibox_web/src/dbchain-js-client/src/blockchain.js"],"names":["Factory","getPrivKey","getPubKey","getAddress","chainIdKey","defaultChainId","chainId","ExtraMsgConstructors","LazyFactory","MsgQueue","Mutex","setChainId","id","localStorage","setItem","getChainId","getItem","resetLazyFactory","addExtraMsgConstructors","module","concat","Object","entries","getWallet","privateKey","publicKey","address","work","job","shift","batch","push","callback","msg","realSignAndBroadcast","console","log","length","startWorking","signAndBroadcast","msgName","args","msgs","forEach","clbk","send","map","x","message","included","setLazyFactory","fromWallet"],"mappings":"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","sourcesContent":["import Factory from './tx_factory'\nimport {getPrivKey, getPubKey, getAddress} from \"./key_manager\"\n\nconst chainIdKey = \"dbchain_chain_id\";\nconst defaultChainId = \"testnet\";\nvar chainId = null\n\nvar ExtraMsgConstructors = []\nvar LazyFactory = null\nvar MsgQueue = []\nvar Mutex = true\n\nfunction setChainId(id) {\n    localStorage.setItem(chainIdKey, id)\n    chainId = id\n}\n\nfunction getChainId() {\n    if (chainId != null) {\n        return chainId\n    }\n    chainId = localStorage.getItem(chainIdKey) || defaultChainId\n    return chainId\n}\n\nfunction resetLazyFactory(){\n    LazyFactory=null;\n}\n\nfunction addExtraMsgConstructors(module) {\n    ExtraMsgConstructors = ExtraMsgConstructors.concat(Object.entries(module))\n}\n\nfunction getWallet() {\n    var privateKey = getPrivKey()\n    var publicKey  = getPubKey()\n    var address    = getAddress()\n\n    return {privateKey, publicKey, address}\n}\n\nasync function work() {\n    var job = MsgQueue.shift()\n    var batch = []\n    while (job != null) {\n        batch.push(job)\n\n        let callback = job.msg[2]\n        if (typeof(callback) == \"function\" || (typeof(callback) == \"boolean\" && callback)) {\n            try {\n                await realSignAndBroadcast(batch)\n            } catch(e) {\n                console.log(\"Aocheesh: \", e)\n            }\n            batch = []\n        }\n        job = MsgQueue.shift()\n    }\n    // just in case the last batch is not empty\n    if (batch.length > 0) {\n        try {\n            await realSignAndBroadcast(batch)\n        } catch(e) {\n            console.log(\"Aocheesh: \", e)\n        }\n    }\n}\n\nasync function startWorking() {\n    // js is single-threaded, so this Mutex lock should work fine\n    if(Mutex) {\n        Mutex = false\n        await work()\n        Mutex = true\n    } else {\n        console.log(\"Another worker is still working. I'll wait in queue.\")\n    }\n}\n\n// when callback is a function or the true value of boolean,\n// we trigger the worker to act\nfunction signAndBroadcast(msgName, args, callback) {\n    let msg = {msg: [msgName, args, callback]}\n    MsgQueue.push(msg)\n    if (typeof(callback) == \"function\" || (typeof(callback) == \"boolean\" && callback)) {\n        startWorking()\n    }\n}\n\nasync function realSignAndBroadcast(batch) { //msgName, args, callback) {\n    if(LazyFactory == null) {\n        LazyFactory = new Factory(getChainId(), getWallet(), ExtraMsgConstructors)\n    }\n    let callback = null\n    let msgs = []\n    batch.forEach(function(job) {\n        let [msgName, args, clbk] = job.msg\n        callback = clbk\n        if(msgName) {\n            msgs.push(LazyFactory[msgName](args))\n        }\n    })\n    let included = await LazyFactory.send(msgs.map(x => x.message))\n    if(typeof(callback) == \"function\") { callback(included) }\n}\n\nasync function setLazyFactory(chainId = 'ytbox', fromWallet = {\n    address: \"cosmos10xww29t2xp6tfycdjx27k4vkjlkww0sws4epdd\",\n    privateKey: [196, 149, 0, 158, 190, 8, 250, 167, 106, 51, 35, 249, 88, 180, 160, 231, 242, 23, 230, 109, 255, 246, 215, 74, 52, 29, 154, 3, 214, 186, 190, 182],\n    publicKey: [2, 229, 103, 24, 144, 188, 0, 90, 230, 158, 146, 113, 88, 173, 45, 177, 103, 160, 105, 61, 97, 186, 244, 28, 85, 241, 77, 233, 45, 72, 214, 86, 164]\n}, msg = []) {\n    LazyFactory = new Factory(chainId, fromWallet, msg)\n    console.log(LazyFactory)\n}\nexport { signAndBroadcast, addExtraMsgConstructors, getChainId, setChainId, resetLazyFactory, setLazyFactory}\n"]}]}
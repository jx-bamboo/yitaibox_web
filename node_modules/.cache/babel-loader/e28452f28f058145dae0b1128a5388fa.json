{"remainingRequest":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/thread-loader/dist/cjs.js!/Users/abadboy/Documents/works/yitaibox_web/node_modules/babel-loader/lib/index.js!/Users/abadboy/Documents/works/yitaibox_web/node_modules/eslint-loader/index.js??ref--13-0!/Users/abadboy/Documents/works/yitaibox_web/src/dbchain-js-client/src/tx_factory/index.js","dependencies":[{"path":"/Users/abadboy/Documents/works/yitaibox_web/src/dbchain-js-client/src/tx_factory/index.js","mtime":1627026042243},{"path":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/cache-loader/dist/cjs.js","mtime":1622543821598},{"path":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/thread-loader/dist/cjs.js","mtime":1622543821656},{"path":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/babel-loader/lib/index.js","mtime":1609932570543},{"path":"/Users/abadboy/Documents/works/yitaibox_web/node_modules/eslint-loader/index.js","mtime":1622543823631}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiL1VzZXJzL2FiYWRib3kvRG9jdW1lbnRzL3dvcmtzL3lpdGFpYm94X3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIi9Vc2Vycy9hYmFkYm95L0RvY3VtZW50cy93b3Jrcy95aXRhaWJveF93ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9Vc2Vycy9hYmFkYm95L0RvY3VtZW50cy93b3Jrcy95aXRhaWJveF93ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvYWJhZGJveS9Eb2N1bWVudHMvd29ya3MveWl0YWlib3hfd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvYWJhZGJveS9Eb2N1bWVudHMvd29ya3MveWl0YWlib3hfd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmVudHJpZXMuanMiOwppbXBvcnQgeyBzaWduVHggfSBmcm9tICIuLi9jb3Ntb3Nfc2lnL2luZGV4IjsKaW1wb3J0ICogYXMgTWVzc2FnZUNvbnN0cnVjdG9ycyBmcm9tICcuL21lc3NhZ2VzJzsKaW1wb3J0IHsgcmVzdEdldCwgcmVzdFBvc3QgfSBmcm9tICcuLi9yZXN0X2xpYic7CmltcG9ydCB7IHVyaUJ1aWxkZXIgfSBmcm9tICIuLi9yZXN0X2NsaWVudCI7CgpmdW5jdGlvbiB0aW1lb3V0KG1zKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICByZXR1cm4gc2V0VGltZW91dChyZXNvbHZlLCBtcyk7CiAgfSk7Cn0KCmZ1bmN0aW9uIHNsZWVwKF94KSB7CiAgcmV0dXJuIF9zbGVlcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfc2xlZXAoKSB7CiAgX3NsZWVwID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhmbikgewogICAgdmFyIF9sZW4sCiAgICAgICAgYXJncywKICAgICAgICBfa2V5LAogICAgICAgIF9hcmdzMyA9IGFyZ3VtZW50czsKCiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgIHJldHVybiB0aW1lb3V0KDEwMDApOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgZm9yIChfbGVuID0gX2FyZ3MzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgICAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBfYXJnczNbX2tleV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHZvaWQgMCwgYXJncyk7CgogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQzLnNlbnQpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTMpOwogIH0pKTsKICByZXR1cm4gX3NsZWVwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIHR4SW5jbHVkZWRJbkJsb2NrKF94MikgewogIHJldHVybiBfdHhJbmNsdWRlZEluQmxvY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX3R4SW5jbHVkZWRJbkJsb2NrKCkgewogIF90eEluY2x1ZGVkSW5CbG9jayA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQodHhIYXNoKSB7CiAgICB2YXIgdXJpLCByZXNwb25zZTsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMDsKICAgICAgICAgICAgdXJpID0gdXJpQnVpbGRlcigidHgtc2ltcGxlLXJlc3VsdCIsIHR4SGFzaCk7CiAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNDsKICAgICAgICAgICAgcmV0dXJuIHJlc3RHZXQodXJpKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ0LnNlbnQ7CgogICAgICAgICAgICBpZiAoIShyZXNwb25zZS5kYXRhLnJlc3VsdC5zdGF0ZSA9PSAnc3VjY2VzcycpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBpZiAoIShyZXNwb25zZS5kYXRhLnJlc3VsdC5zdGF0ZSA9PSAnZmFpbCcpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlKTsKCiAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwoKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTc7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMTQ7CiAgICAgICAgICAgIF9jb250ZXh0NC50MCA9IF9jb250ZXh0NFsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlNCwgbnVsbCwgW1swLCAxNF1dKTsKICB9KSk7CiAgcmV0dXJuIF90eEluY2x1ZGVkSW5CbG9jay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBxdWVyeVR4SW5jbHVzaW9uKF94MykgewogIHJldHVybiBfcXVlcnlUeEluY2x1c2lvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfcXVlcnlUeEluY2x1c2lvbigpIHsKICBfcXVlcnlUeEluY2x1c2lvbiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUodHhIYXNoKSB7CiAgICB2YXIgaXRlcmF0aW9ucywKICAgICAgICBpbmNsdWRlZCwKICAgICAgICByZXN1bHQsCiAgICAgICAgX2FyZ3M1ID0gYXJndW1lbnRzOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaXRlcmF0aW9ucyA9IF9hcmdzNS5sZW5ndGggPiAxICYmIF9hcmdzNVsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M1WzFdIDogMTU7CiAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIHR4SW5jbHVkZWRJbkJsb2NrKHR4SGFzaCk7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBpbmNsdWRlZCA9IF9jb250ZXh0NS5zZW50OwoKICAgICAgICAgICAgaWYgKCEoX3R5cGVvZihpbmNsdWRlZCkgPT0gJ29iamVjdCcpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA2OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgaW5jbHVkZWQpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgaWYgKCFpbmNsdWRlZCkgewogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHRydWUpOwoKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIGl0ZXJhdGlvbnMtLTsKCiAgICAgICAgICAgIGlmICghKGl0ZXJhdGlvbnMgPiAwKSkgewogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0NS50MCA9IHNsZWVwOwogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE0OwogICAgICAgICAgICByZXR1cm4gcXVlcnlUeEluY2x1c2lvbjsKCiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBfY29udGV4dDUudDEgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgX2NvbnRleHQ1LnQyID0gdHhIYXNoOwogICAgICAgICAgICBfY29udGV4dDUudDMgPSBpdGVyYXRpb25zOwogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE5OwogICAgICAgICAgICByZXR1cm4gKDAsIF9jb250ZXh0NS50MCkoX2NvbnRleHQ1LnQxLCBfY29udGV4dDUudDIsIF9jb250ZXh0NS50Myk7CgogICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQ1LnNlbnQ7CgogICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7CgogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTUpOwogIH0pKTsKICByZXR1cm4gX3F1ZXJ5VHhJbmNsdXNpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKdmFyIEZhY3RvcnkgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEZhY3RvcnkoY2hhaW5JZCwgZnJvbVdhbGxldCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICB2YXIgZXh0cmFNc2dDb25zdHJ1Y3Rvckxpc3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IFtdOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGYWN0b3J5KTsKCiAgICB0aGlzLmNoYWluSWQgPSBjaGFpbklkOwogICAgdGhpcy5mcm9tV2FsbGV0ID0gZnJvbVdhbGxldDsKICAgIE9iamVjdC5lbnRyaWVzKE1lc3NhZ2VDb25zdHJ1Y3RvcnMpLmNvbmNhdChleHRyYU1zZ0NvbnN0cnVjdG9yTGlzdCkuZm9yRWFjaChmdW5jdGlvbiAoX3JlZikgewogICAgICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAyKSwKICAgICAgICAgIG5hbWUgPSBfcmVmMlswXSwKICAgICAgICAgIG1lc3NhZ2VDb25zdHJ1Y3RvciA9IF9yZWYyWzFdOwoKICAgICAgX3RoaXNbbmFtZV0gPSBmdW5jdGlvbiAoYXJncykgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICB2YXIgc2VuZGVyQWRkcmVzcyA9IHRoaXMuZnJvbVdhbGxldC5hZGRyZXNzOwogICAgICAgIHZhciBtZXNzYWdlID0gbWVzc2FnZUNvbnN0cnVjdG9yKHNlbmRlckFkZHJlc3MsIGFyZ3MpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICAgICAgc2VuZDogZnVuY3Rpb24gc2VuZCgpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5zZW5kKFttZXNzYWdlXSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0pOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEZhY3RvcnksIFt7CiAgICBrZXk6ICJnZXRBY2NvdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0QWNjb3VudCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgYWNjb3VudDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiByZXN0R2V0KCIvYXV0aC9hY2NvdW50cy8iLmNvbmNhdCh0aGlzLmZyb21XYWxsZXQuYWRkcmVzcykpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBhY2NvdW50ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGFjY291bnQuZGF0YS5yZXN1bHQudmFsdWUpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0QWNjb3VudCgpIHsKICAgICAgICByZXR1cm4gX2dldEFjY291bnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldEFjY291bnQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJzZW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc2VuZCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIobWVzc2FnZXMpIHsKICAgICAgICB2YXIgdHgsIGFjY291bnQsIHNpZ25NZXRhLCBzaWduZWRUeCwgYnJvYWRjYXN0Qm9keSwgcmVzcG9uc2UsIHR4SGFzaCwgaW5jbHVkZWQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHR4ID0gewogICAgICAgICAgICAgICAgICBmZWU6IHsKICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IFtdLAogICAgICAgICAgICAgICAgICAgIGdhczogJzk5OTk5OTk5JwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBtZW1vOiAnJywKICAgICAgICAgICAgICAgICAgbXNnOiBtZXNzYWdlcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEFjY291bnQoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgYWNjb3VudCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgc2lnbk1ldGEgPSB7CiAgICAgICAgICAgICAgICAgIGNoYWluX2lkOiB0aGlzLmNoYWluSWQsCiAgICAgICAgICAgICAgICAgIGFjY291bnRfbnVtYmVyOiAiIiArIGFjY291bnQuYWNjb3VudF9udW1iZXIsCiAgICAgICAgICAgICAgICAgIHNlcXVlbmNlOiAiIiArIGFjY291bnQuc2VxdWVuY2UKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBzaWduZWRUeCA9IHNpZ25UeCh0eCwgc2lnbk1ldGEsIHsKICAgICAgICAgICAgICAgICAgcHJpdmF0ZUtleTogdGhpcy5mcm9tV2FsbGV0LnByaXZhdGVLZXksCiAgICAgICAgICAgICAgICAgIHB1YmxpY0tleTogdGhpcy5mcm9tV2FsbGV0LnB1YmxpY0tleQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBicm9hZGNhc3RCb2R5ID0gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICB0eDogc2lnbmVkVHgsCiAgICAgICAgICAgICAgICAgIG1vZGU6ICdhc3luYycKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3RQb3N0KCIvdHhzIiwgYnJvYWRjYXN0Qm9keSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICB0eEhhc2ggPSByZXNwb25zZS5kYXRhLnR4aGFzaDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnlUeEluY2x1c2lvbih0eEhhc2gpOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgaW5jbHVkZWQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBpbmNsdWRlZCk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBzZW5kKF94NCkgewogICAgICAgIHJldHVybiBfc2VuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2VuZDsKICAgIH0oKQogIH1dKTsKCiAgcmV0dXJuIEZhY3Rvcnk7Cn0oKTsKCmV4cG9ydCB7IEZhY3RvcnkgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/Users/abadboy/Documents/works/yitaibox_web/src/dbchain-js-client/src/tx_factory/index.js"],"names":["signTx","MessageConstructors","restGet","restPost","uriBuilder","timeout","ms","Promise","resolve","setTimeout","sleep","fn","args","txIncludedInBlock","txHash","uri","response","data","result","state","queryTxInclusion","iterations","included","Factory","chainId","fromWallet","extraMsgConstructorList","Object","entries","concat","forEach","name","messageConstructor","senderAddress","address","message","send","account","value","messages","tx","fee","amount","gas","memo","msg","getAccount","signMeta","chain_id","account_number","sequence","signedTx","privateKey","publicKey","broadcastBody","JSON","stringify","mode","txhash"],"mappings":";;;;;;;;;;;AAAA,SAASA,MAAT,QAAuB,qBAAvB;AACA,OAAO,KAAKC,mBAAZ,MAAqC,YAArC;AACA,SAASC,OAAT,EAAkBC,QAAlB,QAAkC,aAAlC;AACA,SAAQC,UAAR,QAA0B,gBAA1B;;AAEA,SAASC,OAAT,CAAiBC,EAAjB,EAAqB;AACjB,SAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO;AAAA,WAAIC,UAAU,CAACD,OAAD,EAAUF,EAAV,CAAd;AAAA,GAAnB,CAAP;AACH;;SAEcI,K;;;;;mEAAf,kBAAqBC,EAArB;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACUN,OAAO,CAAC,IAAD,CADjB;;AAAA;AAAA,uCAA4BO,IAA5B;AAA4BA,cAAAA,IAA5B;AAAA;;AAAA;AAAA,mBAEiBD,EAAE,MAAF,SAAMC,IAAN,CAFjB;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAKeC,iB;;;;;+EAAf,kBAAiCC,MAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEQC,YAAAA,GAFR,GAEcX,UAAU,CAAC,kBAAD,EAAsBU,MAAtB,CAFxB;AAAA;AAAA,mBAGyBZ,OAAO,CAACa,GAAD,CAHhC;;AAAA;AAGQC,YAAAA,QAHR;;AAAA,kBAIQA,QAAQ,CAACC,IAAT,CAAcC,MAAd,CAAqBC,KAArB,IAA4B,SAJpC;AAAA;AAAA;AAAA;;AAAA,8CAKa,IALb;;AAAA;AAAA,kBAOQH,QAAQ,CAACC,IAAT,CAAcC,MAAd,CAAqBC,KAArB,IAA4B,MAPpC;AAAA;AAAA;AAAA;;AAAA,8CAQaH,QARb;;AAAA;AAAA,8CAWa,KAXb;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,8CAcW,KAdX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAkBeI,gB;;;;;8EAAf,kBAAiCN,MAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAyCO,YAAAA,UAAzC,8DAAsD,EAAtD;AAAA;AAAA,mBACwBR,iBAAiB,CAACC,MAAD,CADzC;;AAAA;AACMQ,YAAAA,QADN;;AAAA,kBAEK,QAAOA,QAAP,KAAkB,QAFvB;AAAA;AAAA;AAAA;;AAAA,8CAGWA,QAHX;;AAAA;AAAA,iBAKMA,QALN;AAAA;AAAA;AAAA;;AAAA,8CAMW,IANX;;AAAA;AASMJ,YAAAA,MATN,GASe,KATf;AAUEG,YAAAA,UAAU;;AAVZ,kBAWMA,UAAU,GAAG,CAXnB;AAAA;AAAA;AAAA;;AAAA,2BAYmBX,KAZnB;AAAA;AAAA,mBAY+BU,gBAZ/B;;AAAA;AAAA;AAAA,2BAYiDN,MAZjD;AAAA,2BAYyDO,UAZzD;AAAA;AAAA;;AAAA;AAYIH,YAAAA,MAZJ;;AAAA;AAAA,8CAcSA,MAdT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;IAiBqBK,O;AACnB,mBAAaC,OAAb,EAAsBC,UAAtB,EAA8D;AAAA;;AAAA,QAA5BC,uBAA4B,uEAAJ,EAAI;;AAAA;;AAC5D,SAAKF,OAAL,GAAmBA,OAAnB;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AAEAE,IAAAA,MAAM,CAACC,OAAP,CAAe3B,mBAAf,EAAoC4B,MAApC,CAA2CH,uBAA3C,EACGI,OADH,CACW,gBAAgC;AAAA;AAAA,UAA9BC,IAA8B;AAAA,UAAxBC,kBAAwB;;AACvC,MAAA,KAAI,CAACD,IAAD,CAAJ,GAAa,UAAUnB,IAAV,EAAgB;AAAA;;AAC3B,YAAMqB,aAAa,GAAG,KAAKR,UAAL,CAAgBS,OAAtC;AACA,YAAMC,OAAO,GAAGH,kBAAkB,CAACC,aAAD,EAAgBrB,IAAhB,CAAlC;AAEA,eAAO;AACLuB,UAAAA,OAAO,EAAPA,OADK;AAELC,UAAAA,IAAI,EAAE;AAAA,mBAAM,MAAI,CAACA,IAAL,CAAU,CAACD,OAAD,CAAV,CAAN;AAAA;AAFD,SAAP;AAID,OARD;AASD,KAXH;AAYD;;;;;gFAED;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACsBjC,OAAO,0BAAmB,KAAKuB,UAAL,CAAgBS,OAAnC,EAD7B;;AAAA;AACMG,gBAAAA,OADN;AAAA,iDAESA,OAAO,CAACpB,IAAR,CAAaC,MAAb,CAAoBoB,KAF7B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;0EAKA,kBAAWC,QAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AACMC,gBAAAA,EADN,GACW;AACPC,kBAAAA,GAAG,EAAE;AACHC,oBAAAA,MAAM,EAAE,EADL;AAEHC,oBAAAA,GAAG,EAAK;AAFL,mBADE;AAKPC,kBAAAA,IAAI,EAAE,EALC;AAMPC,kBAAAA,GAAG,EAAEN;AANE,iBADX;AAAA;AAAA,uBAUsB,KAAKO,UAAL,EAVtB;;AAAA;AAUMT,gBAAAA,OAVN;AAYQU,gBAAAA,QAZR,GAYmB;AACfC,kBAAAA,QAAQ,EAAQ,KAAKxB,OADN;AAEfyB,kBAAAA,cAAc,EAAE,KAAKZ,OAAO,CAACY,cAFd;AAGfC,kBAAAA,QAAQ,EAAQ,KAAKb,OAAO,CAACa;AAHd,iBAZnB;AAkBQC,gBAAAA,QAlBR,GAkBmBnD,MAAM,CAACwC,EAAD,EAAKO,QAAL,EAAe;AAACK,kBAAAA,UAAU,EAAE,KAAK3B,UAAL,CAAgB2B,UAA7B;AAAyCC,kBAAAA,SAAS,EAAE,KAAK5B,UAAL,CAAgB4B;AAApE,iBAAf,CAlBzB;AAoBMC,gBAAAA,aApBN,GAoBsBC,IAAI,CAACC,SAAL,CAAe;AACjChB,kBAAAA,EAAE,EAAEW,QAD6B;AAEjCM,kBAAAA,IAAI,EAAE;AAF2B,iBAAf,CApBtB;AAAA;AAAA,uBAyBuBtD,QAAQ,CAAC,MAAD,EAASmD,aAAT,CAzB/B;;AAAA;AAyBMtC,gBAAAA,QAzBN;AA0BMF,gBAAAA,MA1BN,GA0BeE,QAAQ,CAACC,IAAT,CAAcyC,MA1B7B;AAAA;AAAA,uBA2BuBtC,gBAAgB,CAACN,MAAD,CA3BvC;;AAAA;AA2BMQ,gBAAAA,QA3BN;AAAA,kDA4BSA,QA5BT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;;;SAxBmBC,O","sourcesContent":["import { signTx } from \"../cosmos_sig/index\"\nimport * as MessageConstructors from './messages'\nimport { restGet, restPost } from '../rest_lib'\nimport {uriBuilder } from \"../rest_client\"\n\nfunction timeout(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nasync function sleep(fn, ...args) {\n    await timeout(1000);\n    return await fn(...args);\n}\n\nasync function txIncludedInBlock(txHash) {\n  try {\n    var uri = uriBuilder(\"tx-simple-result\",  txHash);\n    let response = await restGet(uri)\n    if (response.data.result.state=='success') {\n      return true\n    }\n    if (response.data.result.state=='fail') {\n      return response\n    }\n     else {\n      return false\n    }\n  } catch(err) {\n    return false\n  }\n}\n\nasync function queryTxInclusion (txHash, iterations = 15) {\n  let included  = await txIncludedInBlock(txHash)\n  if(typeof(included)=='object'){\n    return included;\n  }\n  if (included) {\n    return true\n  }\n\n  var result = false\n  iterations --\n  if (iterations > 0) {\n    result = await sleep(await queryTxInclusion, txHash, iterations)\n  }\n  return result \n}\n\nexport default class Factory {\n  constructor (chainId, fromWallet, extraMsgConstructorList=[]) {\n    this.chainId     = chainId\n    this.fromWallet = fromWallet\n\n    Object.entries(MessageConstructors).concat(extraMsgConstructorList)\n      .forEach(([name, messageConstructor]) => {\n        this[name] = function (args) {\n          const senderAddress = this.fromWallet.address\n          const message = messageConstructor(senderAddress, args)\n\n          return {\n            message,\n            send: () => this.send([message])\n          }\n        }\n      })\n  }\n\n  async getAccount() {\n    var account = await restGet(`/auth/accounts/${this.fromWallet.address}`)\n    return account.data.result.value\n  } \n\n  async send(messages) {\n    var tx = {\n      fee: {\n        amount: [],\n        gas:    '99999999'\n      },\n      memo: '',\n      msg: messages\n    };\n\n    var account = await this.getAccount()\n\n    const signMeta = {\n      chain_id:       this.chainId,\n      account_number: \"\" + account.account_number,\n      sequence:       \"\" + account.sequence\n    }\n\n    const signedTx = signTx(tx, signMeta, {privateKey: this.fromWallet.privateKey, publicKey: this.fromWallet.publicKey})\n\n    var broadcastBody = JSON.stringify({\n      tx: signedTx,\n      mode: 'async'\n    })\n  \n    var response = await restPost(\"/txs\", broadcastBody)\n    var txHash = response.data.txhash\n    var included = await queryTxInclusion(txHash)\n    return included\n  }\n}\n\n"]}]}